<htmlform>

<script type="text/javascript">

if(jQuery){
		
		$j(document).ready(function(){
    if ( $j.browser.msie ) {
        $j(":checkbox").click(function(){
             $j(this).change();
     });
 }
 $j(".enableDisable").each(function(){
     var group = $j(this);
     function disableFn(){
         group.children("#disabled").fadeTo(250,0.33);
         group.children("#disabled").find(":checkbox").attr("checked",false); //uncheck
         group.children("#disabled").find("input[type$='text']").val("");
         group.children("#disabled").find("input").attr("disabled",true);  //disable
     }
 function enableFn(){
     group.children("#disabled").fadeTo(250,1);
     group.children("#disabled").find("input").attr("disabled",false);
 }
 disableFn();
 $j(this).children("#trigger").find(":checkbox:first").change(function(){
     var checked = $j(this).attr("checked");
     if(checked == true){
          enableFn();
     }else{
         disableFn();
     }
 });
});
 
 
 $j(".checkboxGroup").each(function(){
     var group = $j(this);
     var uncheckAll = function(){
         group.find("input[type$='checkbox']").attr("checked",false);
         group.find("input[type$='checkbox']").change();
     }
     var uncheckRadioAndAll = function(){
     group.find("#checkboxAll,.checkboxRadio").find("input[type$='checkbox']").attr("checked",false);
     group.find("#checkboxAll,.checkboxRadio").find("input[type$='checkbox']").change();
 }
 
 
 
 group.find("#checkboxAll").find("input").click(
    
    function(){
         var flip;
         var checked = $j(this).siblings(":checkbox:first").attr("checked");
         if($j(this).attr("name") == $j(this).parents("#checkboxAll:first").find(":checkbox:first").attr("name")){
             checked = $j(this).attr("checked");
             flip = checked;
         }else{
             flip = !checked;
         }
         if($j(this).attr("type") == "text") if(flip == false) flip = !filp; // this is so the user doesn't go to check the checkbox, then uncheck it when they hit the input.
         uncheckAll();
         $j(this).parents("#checkboxAll:first").find(":checkbox").attr("checked",flip);
         $j(this).parents("#checkboxAll:first").find(":checkbox").change();
     }
 );
 
 
 
 group.find(".checkboxRadio").find("input[type$='checkbox']").click(function(){

	 uncheckAll();
     $j(this).siblings("input[type$='checkbox']").attr("checked",false);
     $j(this).attr("checked",true);
     $j(this).change();
	 
	 
 });
 
 group.find("#checkboxCheckbox").click(
     function(){
         uncheckRadioAndAll();
     }
 );
 });
 });

      $j(function(){
          $j('#1-removeEntry').remove();
          $j('#20-addEntry').remove();
          $j('#1-toggleContainer').show();
 
        });
 
 
      $j(function(){
      $j('button.addEntry').live("click", function(){
      var correctedAddButtonId = parseFloat(this.id) + 1;
      var contentAddId = "#" + correctedAddButtonId + "-toggleContainer";
      $j(contentAddId).toggle(true);
      $j('#' + this.id).toggle(false); $j('#' + parseFloat(this.id) + '-removeEntry').toggle(false);
      return false;});
    });
 
     $j(function(){
      $j('button.removeEntry').live("click", function(){
      var correctedRemoveButtonId = parseFloat(this.id) - 1;
      var contentAddId = "#" + parseFloat(this.id) + "-toggleContainer";
      $j(contentAddId).toggle(false);
      $j( ':input:not(:button)', contentAddId).val([]);
      $j('#' + correctedRemoveButtonId + '-addEntry').toggle(true); $j('#' + correctedRemoveButtonId + '-removeEntry').toggle(true);
 
      return false;});
			
		
		});
		
		$j(function(){
			
			//Configration for hypertension
			$j("#h_no").click(function() {
				if($j("#h_no").attr("checked")) {
					
					$j("#htn").hide();
				}
			});
			$j("#h_yes").click(function() {
				if($j("#h_yes").attr("checked")) {
				
					$j("#htn").show();
				}
			});
			
			//configuration for cva 
			$j("#c_no").click(function() {
				if($j("#c_no").attr("checked")) {
					
					$j("#cva").hide();
				}
			});
			$j("#c_yes").click(function() {
				if($j("#c_yes").attr("checked")) {
				
					$j("#cva").show();
				}
			});
			
			//configuration for Myocardial Infarction
			$j("#m_no").click(function() {
				if($j("#m_no").attr("checked")) {
					
					$j("#mi").hide();
				}
			});
			$j("#m_yes").click(function() {
				if($j("#m_yes").attr("checked")) {
				
					$j("#mi").show();
				}
			});
			
			beforeSubmit.push(function() {
			
				if(($j("#m_yes").attr("checked"))) {
					
					
					if( getValue("dd_mi.value") == "" ) {alert("MI");return false;}
				}
				else if(($j("#c_yes").attr("checked"))) {
					
					if( getValue("dd_cva.value") == "" ) {alert("CVA");return false;}
				}
				else if(($j("#h_yes").attr("checked"))) {
					
					if( getValue("dd_htn.value") == "" ) {alert("HTN");return false;}
				}
				else {
				
					return true;
				}
				return true;
			});
			
			//Preselect the following input fields for validation
			$j("#h_yes").attr("checked",true);
			$j("#c_yes").attr("checked",true);
			$j("#m_yes").attr("checked",true);
			
			$j(function(){
				$j('.type').hide();
			});
		});
		
}//end outmost if


</script>
	<!--<macros>
                paperFormId = (Fill this in)
		headerColor =#009d8e
		fontOnHeaderColor = white
	</macros>-->

	<style>
		.section {
			border: 1px solid #009d8e;
			padding: 2px;
			text-align: left;
			margin-bottom: 1em;
		}
		.sectionHeader {
			background-color: #009d8e;
			color: white;
			display: block;
			padding: 2px;
			font-weight: bold;
		}
		table.baseline-aligned td {
			vertical-align: baseline;
		}
		.d_date {
			color: blue;
		}
		.required {
		
			color:red;
		}
	</style>

	<span style="float:right">Paper Form ID: $paperFormId</span>
	<h2>PATIENT MEDICAL HISTORY</h2>

	<section headerLabel="1. Encounter Details">
		<table class="baseline-aligned">
			<tr>
				<td>Date:</td>
				<td><encounterDate default="today"/></td>
				<td><pre>			</pre></td>
				<td>Location:</td>
				<td><encounterLocation default="Unknown Location" /></td>
				<td><pre>			</pre></td>
				<td>Provider:</td>
				<td><encounterProvider default="currentUser" role="Provider" /></td>
				<td><pre>			</pre></td>
				<td class="type">Type:</td>
				<td class="type"><encounterType default="PATHIST" /></td>
				
			</tr>
		</table>
	</section>

	<section headerLabel="2. Patient Information">
		<table class="baseline-aligned">
			<tr>
				<td>Name:</td>
				<td><lookup class="value" expression="patient.personName"/></td>
				<td><pre>		</pre></td>
				<td>Manual ID:</td>
				<td><lookup class="value" complexExpression="#foreach( $patId in $patientIdentifiers.get('Old Identification Number') ) $patId #end "/></td>
				<td><pre>		</pre></td>
				<td>Auto ID:</td>
				<td><lookup class="value" complexExpression="#foreach( $patId in $patientIdentifiers.get('OpenMRS Identification Number') ) $patId #end"/></td>
				<td><pre>		</pre></td>
				<td>Gender:</td>
				<td><lookup class="value" expression="patient.gender"/></td>
			</tr>
			
		</table>
	</section>

        <section headerLabel="3. Medical Information">

		<br />
		<fieldset><legend>Family History</legend>
		<table class="baseline-aligned">
			<tr>
				<td>Family History of Diabetes Mellitus:</td>
				<td><obs conceptId="140228" style="radio" answerConceptIds="1065,1066,1067" answerLabels="Yes,No,Unknown" defaultValue="1067" /></td>
				<ifMode mode="ENTER">
					<td class="lookup">
						<lookup expression="fn.latestObs(140228).valueNumeric" class="value"/>
					</td>
				</ifMode>
			</tr>
		</table>
		</fieldset>

		<br />
		<br />
		
		<fieldset><legend>Past Medical History</legend>
		<table class="baseline-aligned">

		<form>   
            <tr>
				<obsgroup groupingConceptId="159947">
					<td>
						Diabetes Mellitus
					</td>
					<td>
						<obs conceptId="1284" answerClasses="Diagnosis" style="autocomplete" />
					</td>
					<td>Diagnosis Date <obs conceptId="159948" id="dd_dm" /></td>
				</obsgroup>
			</tr>
			<tr>
				<obsgroup groupingConceptId="159947">
					<td>
						Myocardial Infarction
					</td>
					<td>
						<obs conceptId="1284" answerClasses="Diagnosis" style="autocomplete" />
					</td>
					<td>Diagnosis Date <obs conceptId="159948" id="dd_dm" /></td>
				</obsgroup>
			</tr>
			<tr>
				<obsgroup groupingConceptId="159947">
					<td>
						CerebroVascular Accident
					</td>
					<td>
						<obs conceptId="1284" answerClasses="Diagnosis" style="autocomplete" />
					</td>
					<td>Diagnosis Date <obs conceptId="159948" id="dd_dm" /></td>
				</obsgroup>
			</tr>
			<tr>
				<obsgroup groupingConceptId="159947">
					<td>
						Hypertension
					</td>
					<td>
						<obs conceptId="1284" answerClasses="Diagnosis" style="autocomplete" />
					</td>
					<td>Diagnosis Date <obs conceptId="159948" id="dd_dm" /></td>
				</obsgroup>
			</tr>
			<ifMode mode="ENTER">
		
			<tr>
				<td></td>
				<td class="lookup">
				
					<lookup complexExpression="#foreach($enc in $fn.allEncounters(null))
								
								#if($form == $enc.form.formId)
								
									#set($latestEnc = $fn.latestEncounter($enc.encounterType))
									
									#foreach($obs in $latestEnc.obs)
										
									
												#if($obs.concept.conceptId == 1284)
													 $obs.valueCoded.name
													 &lt;br &gt;
												#end
																		
									#end

								
									#break
								#end
							#end" class="value" />
				</td>
				<td class="lookup">
				
					<lookup complexExpression="#foreach($enc in $fn.allEncounters(null))
								
								#if($form == $enc.form.formId)
								
									#set($latestEnc = $fn.latestEncounter($enc.encounterType))
									
									#foreach($obs in $latestEnc.obs)
										
									
												#if($obs.concept.conceptId == 159948)
													 $obs.valueDate
													 &lt;br &gt;
												#end
																		
									#end

								
									#break
								#end
							#end" class="value" />
				</td>
				
			</tr>

		</ifMode>
			
		</form>

		</table>
		</fieldset>
		
		<br />
		<br />
		<fieldset><legend>Past Surgical History</legend>
		<table class="baseline-aligned">
			<tr>
				<td>Amputation:</td>
				<td><obs conceptId="161568" answerConceptIds="161567,161566,1066" answerLabels="Yes - DM Related,Yes DM not Related,No" style="radio" /></td>
				<ifMode mode="ENTER">
					<td class="lookup">
						<lookup expression="fn.latestObs(161568).valueNumeric" class="value"/>
					</td>
				</ifMode>
			</tr>
		</table>
		</fieldset>
			<tr>
				<td colspan="2"><br /></td>
			</tr>
		
		<br />
		<br />
		<fieldset><legend>Social History</legend>
		<table class="baseline-aligned">
			<tr>
				<td>Smoker:</td>
				<td><obs conceptId="152722" answerConceptIds="1065,1066,1067" answerLabels="Yes,No,Unknown" style="radio" /></td>
				<ifMode mode="ENTER">
					<td class="lookup">
						<lookup expression="fn.latestObs(152722).valueNumeric" class="value"/>
					</td>
				</ifMode>
			</tr>
			<tr>
				<td>Exercise Time (In Minutes/day):</td>
				<td><obs conceptId="161262" /></td>
				<ifMode mode="ENTER">
					<td class="lookup">
						<lookup expression="fn.latestObs(161262).valueNumeric" class="value"/>
					</td>
				</ifMode>
			</tr>
		</table>
		</fieldset>

	</section>


	<submit/>


</htmlform>